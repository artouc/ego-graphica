# ego Graphica - データモデル定義
#
# このファイルはllm/REFACTOR.mdから抽出した型定義です。
# 実装変更時は本ファイルも必ず更新してください。

# ==============================================================================
# Enums（列挙型）
# ==============================================================================

enums:
  PersonaTone:
    description: ペルソナの話し方トーン
    values:
      - formal      # 丁寧・フォーマル
      - friendly    # フレンドリー
      - artistic    # 芸術的・詩的
      - professional # プロフェッショナル
      - playful     # 遊び心のある

  FileType:
    description: 作品ファイル形式
    values:
      - png
      - jpg
      - wav
      - mp4

  WorkType:
    description: 作品の種類
    values:
      - client   # クライアントワーク
      - personal # 自主制作

  SalesStatus:
    description: 販売状況
    values:
      - sold        # 売却済
      - reserved    # 売約済
      - available   # 販売中
      - unavailable # 非売品

  MessageRole:
    description: メッセージの役割
    values:
      - user
      - assistant
      - system

  HearingRole:
    description: ヒアリングメッセージの役割
    values:
      - user
      - assistant

  AIProvider:
    description: AIプロバイダー
    values:
      - claude  # Anthropic Claude 4.5 Opus
      - grok    # xAI Grok 4.1 Fast Reasoning

# ==============================================================================
# Types（型定義）
# ==============================================================================

types:
  # ----------------------------------------------------------------------------
  # Profile（アーティスト基本情報）
  # ----------------------------------------------------------------------------
  # ファイル: packages/shared/src/types/profile.ts
  # Firestore: /{bucket}/profile

  Profile:
    description: アーティスト基本情報
    fields:
      name:
        type: string
        required: true
        description: アーティスト名
      bucket:
        type: string
        required: true
        description: バケット名（一意識別子）
      created:
        type: Timestamp
        required: true
        description: 作成日時
      updated:
        type: Timestamp
        required: true
        description: 更新日時

  # ----------------------------------------------------------------------------
  # Persona（ペルソナ設定）
  # ----------------------------------------------------------------------------
  # ファイル: packages/shared/src/types/persona.ts
  # Firestore: /{bucket}/persona

  Persona:
    description: ペルソナ設定（CAG用）
    fields:
      character:
        type: string
        required: false
        description: キャラクター名
      motif:
        type: string
        required: true
        description: モチーフ（カエル、猫など）
      tone:
        type: PersonaTone
        required: true
        description: 話し方のトーン
      philosophy:
        type: string
        required: false
        description: 創作哲学
      influences:
        type: string[]
        required: true
        description: 影響を受けた作家・文化
      samples:
        type: SampleResponse[]
        required: true
        description: 理想的な応答例
      avoidances:
        type: string[]
        required: true
        description: 避けるべきトピック
      writing_style:
        type: WritingStyle
        required: false
        description: 文体分析結果（自動生成）
      style_samples:
        type: string[]
        required: false
        description: 実際のテキストから抽出したサンプル文
      provider:
        type: AIProvider
        required: false
        description: AIプロバイダー（claude | grok）

  SampleResponse:
    description: 理想的な応答例
    fields:
      situation:
        type: string
        required: true
        description: 状況説明
      message:
        type: string
        required: true
        description: 顧客の発言例
      response:
        type: string
        required: true
        description: 理想的な応答

  PunctuationStyle:
    description: 句読点スタイル
    fields:
      uses_exclamation:
        type: boolean
        required: true
        description: 感嘆符を使用するか
      uses_question_marks:
        type: boolean
        required: true
        description: 疑問符を多用するか
      uses_emoji:
        type: boolean
        required: true
        description: 絵文字を使用するか
      period_style:
        type: string
        required: true
        description: 句点スタイル（"。" | "." | "none"）
      comma_style:
        type: string
        required: true
        description: 読点スタイル（"、" | ","）

  WritingStyle:
    description: 文体分析結果
    fields:
      sentence_endings:
        type: string[]
        required: true
        description: 文末表現パターン（例：["です", "ます", "である"]）
      punctuation:
        type: PunctuationStyle
        required: true
        description: 句読点スタイル
      formality_level:
        type: number
        required: true
        description: フォーマル度（0.0-1.0、1.0が最もフォーマル）
      characteristic_phrases:
        type: string[]
        required: true
        description: 特徴的なフレーズ
      avoid_patterns:
        type: string[]
        required: true
        description: 避けるべきパターン
      sentence_length:
        type: string
        required: true
        description: 一文の平均的な長さ（"short" | "medium" | "long"）
      description:
        type: string
        required: true
        description: 文体の総合的な説明

  # ----------------------------------------------------------------------------
  # Work（作品データ）
  # ----------------------------------------------------------------------------
  # ファイル: packages/shared/src/types/work.ts
  # Firestore: /{bucket}/works/{workId}

  Work:
    description: 作品データ
    fields:
      id:
        type: string
        required: true
        description: 作品ID（Firestore自動生成）
      url:
        type: string
        required: true
        description: Firebase Storage URL
      filetype:
        type: FileType
        required: true
        description: ファイル形式
      title:
        type: string
        required: true
        description: タイトル
      date:
        type: Timestamp
        required: true
        description: 作成年月日
      worktype:
        type: WorkType
        required: true
        description: クライアントワーク or 自主制作
      client:
        type: string
        required: false
        description: クライアント名（worktype=client時のみ）
      status:
        type: SalesStatus
        required: true
        description: 販売状況
      description:
        type: string
        required: false
        description: 説明（自由記述）
      story:
        type: string
        required: false
        description: 制作ストーリー（自由記述）
      analysis:
        type: ImageAnalysis
        required: false
        description: Claude Vision解析結果（マルチモーダルRAG用）
      created:
        type: Timestamp
        required: true
        description: 登録日時
      updated:
        type: Timestamp
        required: true
        description: 更新日時

  ImageAnalysis:
    description: Claude Vision画像解析結果（マルチモーダルRAG用）
    fields:
      colors:
        type: string[]
        required: true
        description: 主要な色（例: ["深い青", "白", "金"]）
      colormood:
        type: string
        required: true
        description: 色の印象（例: "落ち着いた", "鮮やか"）
      composition:
        type: string
        required: true
        description: 構図（例: "中央配置", "三分割"）
      style:
        type: string
        required: true
        description: スタイル（例: "写実的", "抽象的"）
      technique:
        type: string
        required: true
        description: 技法（例: "油彩風", "水彩風"）
      subject:
        type: string
        required: true
        description: 主題（例: "海辺の風景"）
      elements:
        type: string[]
        required: true
        description: 要素（例: ["波", "夕日", "岩"]）
      mood:
        type: string
        required: true
        description: 雰囲気（例: "静謐", "躍動的"）
      narrative:
        type: string
        required: true
        description: 物語性
      tags:
        type: string[]
        required: true
        description: 推奨タグ
      searchable:
        type: string
        required: true
        description: 検索用テキスト（全体を統合した自然言語説明）

  # ----------------------------------------------------------------------------
  # File（アップロードファイル）
  # ----------------------------------------------------------------------------
  # ファイル: packages/shared/src/types/file.ts
  # Firestore: /{bucket}/files/items/{fileId}

  File:
    description: アップロードファイルメタデータ
    fields:
      id:
        type: string
        required: true
        description: ファイルID（Firestore自動生成）
      filename:
        type: string
        required: true
        description: 元ファイル名
      filetype:
        type: string
        required: true
        description: ファイル形式（pdf, jpg, png, mp3, m4a, wav, mp4）
      urls:
        type: Record<string, string>
        required: true
        description: Storage URL群（raw, text, image_1, image_2...）
      preview:
        type: string
        required: true
        description: テキストプレビュー（1000文字まで）
      created:
        type: Timestamp
        required: true
        description: 作成日時

  # ----------------------------------------------------------------------------
  # FromUrl（スクレイピングデータ）
  # ----------------------------------------------------------------------------
  # ファイル: packages/shared/src/types/from_url.ts
  # Firestore: /{bucket}/from-url/{urlId}

  FromUrl:
    description: URLスクレイピングデータ
    fields:
      id:
        type: string
        required: true
        description: URL ID（Firestore自動生成）
      url:
        type: string
        required: true
        description: 元URL
      title:
        type: string
        required: false
        description: ページタイトル
      content:
        type: string
        required: true
        description: 本文
      text_url:
        type: string
        required: false
        description: Firebase Storage URL（/{bucket}/data/{urlId}/url.txt）
      scraped:
        type: Timestamp
        required: true
        description: スクレイピング日時
      created:
        type: Timestamp
        required: true
        description: 登録日時

  # ----------------------------------------------------------------------------
  # Session（エージェント会話）
  # ----------------------------------------------------------------------------
  # ファイル: packages/shared/src/types/session.ts
  # Firestore: /{bucket}/session/{sessionId}

  Session:
    description: エージェント会話セッション
    fields:
      id:
        type: string
        required: true
        description: セッションID（Firestore自動生成）
      started:
        type: Timestamp
        required: true
        description: 開始日時
      updated:
        type: Timestamp
        required: true
        description: 更新日時
      messages:
        type: number
        required: true
        description: メッセージ数
      summary:
        type: string
        required: false
        description: AIによる要約

  # Firestore: /{bucket}/session/{sessionId}/messages/{messageId}

  SessionMessage:
    description: エージェント会話メッセージ
    fields:
      id:
        type: string
        required: true
        description: メッセージID（Firestore自動生成）
      session:
        type: string
        required: true
        description: セッションID
      role:
        type: MessageRole
        required: true
        description: メッセージの役割
      content:
        type: string
        required: true
        description: メッセージ内容
      tools:
        type: ToolCallResult[]
        required: false
        description: Tool Calling結果
      created:
        type: Timestamp
        required: true
        description: 作成日時

  ToolCallResult:
    description: Tool Calling実行結果
    fields:
      name:
        type: string
        required: true
        description: ツール名
      input:
        type: Record<string, unknown>
        required: true
        description: 入力パラメータ
      output:
        type: Record<string, unknown>
        required: true
        description: 出力結果
      component:
        type: string
        required: false
        description: 表示に使うVueコンポーネント名

  # ----------------------------------------------------------------------------
  # Hearing（ヒアリング）
  # ----------------------------------------------------------------------------
  # ファイル: packages/shared/src/types/hearing.ts
  # Firestore: /{bucket}/hearing/{hearingId}

  Hearing:
    description: ヒアリングセッション
    fields:
      id:
        type: string
        required: true
        description: ヒアリングID（Firestore自動生成）
      started:
        type: Timestamp
        required: true
        description: 開始日時
      updated:
        type: Timestamp
        required: true
        description: 更新日時
      messages:
        type: number
        required: true
        description: メッセージ数
      summary:
        type: string
        required: false
        description: 要約

  # Firestore: /{bucket}/hearing/{hearingId}/messages/{messageId}

  HearingMessage:
    description: ヒアリングメッセージ
    fields:
      id:
        type: string
        required: true
        description: メッセージID（Firestore自動生成）
      hearing:
        type: string
        required: true
        description: ヒアリングID
      role:
        type: HearingRole
        required: true
        description: メッセージの役割
      content:
        type: string
        required: true
        description: メッセージ内容
      created:
        type: Timestamp
        required: true
        description: 作成日時

# ==============================================================================
# Pinecone Vector Metadata
# ==============================================================================

pinecone:
  index: egographica
  dimensions: 3072
  model: text-embedding-3-large
  chunking:
    chunk_size: 1000
    overlap: 200
  vector_id_format:
    - work_{workId}_chunk_{n}
    - url_{urlId}_chunk_{n}
    - file_{fileId}_chunk_{n}

  VectorMetadata:
    description: Pineconeベクトルメタデータ
    fields:
      bucket:
        type: string
        required: true
        description: アーティストバケット名（Namespace）
      sourcetype:
        type: string
        required: true
        description: データソース種別（work | url | file）
      source:
        type: string
        required: true
        description: FirestoreドキュメントID
      title:
        type: string
        required: true
        description: タイトル
      text:
        type: string
        required: true
        description: 検索用テキスト（max 1000 chars）
      chunk_index:
        type: number
        required: false
        description: チャンクインデックス（0始まり）
      total_chunks:
        type: number
        required: false
        description: 総チャンク数
      colors:
        type: string[]
        required: false
        description: 主要な色（ImageAnalysisから）
      style:
        type: string
        required: false
        description: スタイル（ImageAnalysisから）
      mood:
        type: string
        required: false
        description: 雰囲気（ImageAnalysisから）
      created:
        type: string
        required: true
        description: 作成日時（ISO 8601）

# ==============================================================================
# Firebase Storage Structure
# ==============================================================================

storage:
  structure:
    description: Firebase Storage構造
    paths:
      - path: /{bucket}/data/raw/
        description: 生データ（元ファイル名維持）
        filetypes:
          - pdf
          - mp3
          - m4a
          - wav
          - jpg
          - png
          - mp4
      - path: /{bucket}/data/{fileId}/
        description: 処理済みデータ（ファイル）
        files:
          - pdf.txt: 全文テキスト（PDF）
          - pdf-{n}.png: 埋め込み画像（PDF）
          - audio.txt: 文字起こし（音声）
          - image.json: Claude Vision解析結果（画像）
      - path: /{bucket}/data/{urlId}/
        description: 処理済みデータ（URL）
        files:
          - url.txt: スクレイピング結果テキスト

# ==============================================================================
# Firestore Collection Structure
# ==============================================================================

firestore:
  structure:
    description: Firestoreコレクション構造
    collections:
      - path: /{bucket}/profile
        type: Profile
        description: アーティスト基本情報（単一ドキュメント）

      - path: /{bucket}/persona
        type: Persona
        description: ペルソナ設定（単一ドキュメント）

      - path: /{bucket}/works/{workId}
        type: Work
        description: 作品データ

      - path: /{bucket}/files/items/{fileId}
        type: File
        description: アップロードファイルメタデータ

      - path: /{bucket}/from-url/{urlId}
        type: FromUrl
        description: スクレイピングデータ

      - path: /{bucket}/session/{sessionId}
        type: Session
        description: エージェント会話セッション

      - path: /{bucket}/session/{sessionId}/messages/{messageId}
        type: SessionMessage
        description: エージェント会話メッセージ（サブコレクション）

      - path: /{bucket}/hearing/{hearingId}
        type: Hearing
        description: ヒアリングセッション

      - path: /{bucket}/hearing/{hearingId}/messages/{messageId}
        type: HearingMessage
        description: ヒアリングメッセージ（サブコレクション）
